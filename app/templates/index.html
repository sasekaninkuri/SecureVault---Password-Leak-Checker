<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SecureLink Analyzer</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <div class="navbar">
    <h2>SecureLink</h2>
    <div class="nav-links">
      <a href="/">Home</a>
      <a href="/about">About</a>
      <a href="/report">Report</a>
      <a href="/contact">Contact</a>
    </div>
  </div>

  <section class="container-image">
    <div class="container">
      <h1 class="title">SecureLink Analyzer</h1>

      <input id="urlInput" type="text" placeholder="Enter a URL..." class="input" />
      <button onclick="analyzeURL()" class="button">Analyze</button>
      <button onclick="exportReport()" class="button">Export Report</button>

      <div class="card-container">
        <div class="card"><h3>HTTPS Check</h3><p id="httpsStatus">Checking...</p></div>
        <div class="card"><h3>Domain Analysis</h3><p id="domainAnalysis">Analyzing...</p></div>
        <div class="card"><h3>Redirection Check</h3><p id="redirectInfo">Loading...</p></div>
        <div class="card"><h3>Phishing Risk</h3><p id="phishingRisk">Evaluating...</p></div>
        <div class="card"><h3>Live Risk Score</h3><canvas id="riskChart" width="200" height="200"></canvas></div>
      </div>

      <button onclick="clearHistory()" class="button">Clear History</button>

      <div class="result" id="result"></div>

      <h2>Historical URL Lookups</h2>
      <ul id="historyList"></ul>
    </div>

    <section id="educational-chat" style="display: none;">
      <div class="chat-container" id="chat-container">
        <h2>ðŸ’¬ Ask Me Anything</h2>
        <div id="chat-box">
          <div class="bot-msg">Hello! I'm your CyberSec Bot ðŸ¤–. How can I help you today?</div>
        </div>
        <div class="chat-input">
          <input type="text" id="user-input" placeholder="Ask me about anything ..." />
          <button onclick="sendMessage()">Send</button>
        </div>
      </div>
    </section>

    <script>
      async function analyzeURL() {
        const url = document.getElementById('urlInput').value;
        if (!url) {
          alert('Please enter a URL.');
          return;
        }
      
        try {
          const response = await fetch('/analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url })
          });
      
          const data = await response.json();
      
          // Update UI with backend results or fallback to error text
          document.getElementById('httpsStatus').innerText = data.https_check || "Error";
          document.getElementById('domainAnalysis').innerText = data.domain_analysis || "Error";
          document.getElementById('redirectInfo').innerText = data.redirect_check || "Error";
          document.getElementById('phishingRisk').innerText = data.phishing_risk || "Error";
      
          // Display extended info in the result div
          document.getElementById('result').innerHTML = `
            <strong>Verdict:</strong> ${data.verdict || 'N/A'}<br/>
            <strong>Notes:</strong> ${data.notes || 'None'}<br/>
            <strong>Score:</strong> ${data.score ?? 'N/A'}<br/><br/>
      
            <strong>WHOIS Info:</strong><br/>
            Domain: ${data.whois_info?.domain || 'N/A'}<br/>
            Registrar: ${data.whois_info?.registrar || 'N/A'}<br/>
            Created: ${data.whois_info?.created || 'N/A'}<br/>
            Expires: ${data.whois_info?.expires || 'N/A'}<br/><br/>
      
            <strong>SSL Certificate:</strong><br/>
            Issuer: ${data.ssl_certificate?.issuer || 'N/A'}<br/>
            Expires: ${data.ssl_certificate?.expires || 'N/A'}<br/><br/>
      
            ${data.suggestions ? '<strong>Suggestions:</strong> ' + data.suggestions.join(', ') : ''}
          `;
      
          // Optional: visualize score in chart
          updateChart(data.score);
      
        } catch (error) {
          console.error('Error analyzing URL:', error);
          alert('Failed to analyze the URL. Please try again later.');
        }
      }
      
      function updateChart(score) {
        const ctx = document.getElementById('riskChart').getContext('2d');
        if (window.riskChart) window.riskChart.destroy(); // avoid duplicate charts
      
        window.riskChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['Risk', 'Safe'],
            datasets: [{
              data: [score || 0, 100 - (score || 0)],
              backgroundColor: ['#e74c3c', '#2ecc71'],
              borderWidth: 1
            }]
          },
          options: {
            plugins: {
              legend: { display: false }
            },
            cutout: '70%'
          }
        });
      }
      </script>
      
    
    <button class="chat-toggle" onclick="toggleChat()">ðŸ’¬</button>







     <div id="backToTop" onclick="scrollToTop()">â¬† Top</div>

    <footer>
      <p>Â© 2025 SecureLink Analyzer. All rights reserved.</p>
    </footer>
  </section>







    
  

<script src="{{ url_for('static', filename='chatbox.js') }}"></script>
</body>
</html>